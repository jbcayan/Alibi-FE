(()=>{var e={};e.id=5997,e.ids=[5997],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5957:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var r=s(60687);s(43210);var i=s(14952),a=s(32192),n=s(85814),o=s.n(n);let l=({items:e,separator:t=(0,r.jsx)(i.A,{className:"w-4 h-4 text-gray-400"}),className:s="",showHome:n=!0,homeLabel:l="ホーム",homeHref:c="/"})=>{let d=n?[{label:l,href:c,icon:(0,r.jsx)(a.A,{className:"w-4 h-4"})},...e]:e;return(0,r.jsx)("nav",{className:`flex items-center space-x-1 text-sm ${s}`,"aria-label":"Breadcrumb",children:(0,r.jsx)("ol",{className:"flex items-center space-x-1",children:d.map((e,s)=>{let i=s===d.length-1,a=e.isActive||i;return(0,r.jsxs)("li",{className:"flex items-center",children:[s>0&&(0,r.jsx)("span",{className:"mx-2 flex-shrink-0",children:t}),e.href&&!a?(0,r.jsx)(o(),{href:e.href,children:(0,r.jsxs)("p",{className:"flex items-center  text-gray-600 hover:text-gray-900 transition-colors duration-200 px-1 py-1 rounded-md hover:bg-gray-100",children:[e.icon,(0,r.jsx)("span",{children:e.label})]})}):(0,r.jsxs)("span",{className:`flex items-center gap-1 px-2 py-1 rounded-md ${a?"text-blue-600 bg-blue-50 font-medium":"text-gray-500"}`,children:[e.icon,(0,r.jsx)("span",{children:e.label})]})]},s)})})})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20463:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/(admin)/admin/(routes)/photo-albums/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/(admin)/admin/(routes)/photo-albums/page.tsx","default")},21439:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(60687);let i=({variant:e="primary",leftIcon:t,className:s="",disabled:i,children:a,onClick:n,type:o="button"})=>(0,r.jsxs)("button",{type:o,onClick:n,disabled:i,className:`flex items-center gap-2 px-4 lg:py-3 py-2  rounded-lg font-medium transition-colors disabled:opacity-50 ${{primary:"bg-blue-600 text-white hover:bg-blue-700",secondary:"bg-gray-200 text-gray-700 hover:bg-gray-300",danger:"bg-red-600 text-white hover:bg-red-700"}[e]} ${s}`,children:[t,a]})},29260:(e,t,s)=>{Promise.resolve().then(s.bind(s,36391))},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},36391:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>q});var r=s(60687),i=s(43210),a=s(51423),n=s(16023);let o=({photo:e,onDelete:t})=>(0,r.jsxs)("div",{className:"group overflow-hidden rounded-lg border border-gray-200 bg-white transition-all hover:shadow-lg",children:[(0,r.jsx)("div",{className:"aspect-square overflow-hidden",children:(0,r.jsx)("img",{src:e.url,alt:e.title||"アリバイ写真",className:"h-full w-full object-cover transition-transform group-hover:scale-105"})}),(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("p",{className:"mb-1 truncate text-sm text-gray-800",children:e.title||"タイトルなし"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString("ja-JP")}),(0,r.jsx)("div",{className:"mt-2 flex justify-end space-x-2",children:(0,r.jsx)("button",{onClick:()=>t(e.id),className:"text-gray-600 hover:text-red-500",children:"\uD83D\uDDD1️"})})]})]});var l=s(21439);let c=({label:e,type:t="text",placeholder:s,error:i,accept:a,register:n,onChange:o})=>(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,r.jsx)("input",{type:t,accept:a,placeholder:s,onChange:o,...n,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),i&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i})]}),d=({label:e,options:t,error:s,register:i})=>(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,r.jsx)("select",{...i,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:t.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),s&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:s})]}),u=({label:e,placeholder:t,rows:s=3,register:i})=>(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,r.jsx)("textarea",{rows:s,placeholder:t,...i,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]});var h=s(63442),p=s(27605),m=s(11860),x=s(9275);let b=x.z.object({title:x.z.string().min(1,"タイトルは必須です"),category:x.z.string().min(1,"カテゴリーを選択してください"),description:x.z.string().optional(),file:x.z.any().refine(e=>!0,"写真ファイルを選択してください").refine(e=>!0,"ファイルサイズは5MB以下にしてください").refine(e=>!0,"対応していないファイル形式です")}),g=({isOpen:e,onClose:t,title:s,children:i})=>e?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:t}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-2xl mx-4 bg-white rounded-lg shadow-xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:s}),(0,r.jsx)("button",{onClick:t,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:(0,r.jsx)(m.A,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsx)("div",{className:"p-6",children:i})]})]}):null,f=({isOpen:e,onClose:t,onSubmit:s,selectedCategory:a})=>{let[n,o]=(0,i.useState)(null),[m,x]=(0,i.useState)(""),{register:f,handleSubmit:v,formState:{errors:y},reset:j,setValue:w,watch:N}=(0,p.mN)({resolver:(0,h.u)(b),defaultValues:{title:"",category:"all"===a?"other":a,description:""}}),k=()=>{t(),j(),o(null),x(""),m&&URL.revokeObjectURL(m)};return(0,r.jsx)(g,{isOpen:e,onClose:k,title:"新しい写真をアップロード",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(c,{label:"写真ファイル",type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];t&&(o(t),w("file",t),x(URL.createObjectURL(t)))},error:"string"==typeof y.title?.message?y.title.message:void 0}),m&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"プレビュー"}),(0,r.jsx)("div",{className:"aspect-video overflow-hidden rounded-lg bg-gray-100",children:(0,r.jsx)("img",{src:m,alt:"アップロード予定の写真",className:"h-full w-full object-contain"})})]}),(0,r.jsx)(c,{label:"タイトル",placeholder:"写真のタイトルを入力",register:f("title"),error:y.title?.message}),(0,r.jsx)(d,{label:"カテゴリー",options:[{value:"work",label:"仕事"},{value:"travel",label:"旅行"},{value:"event",label:"イベント"},{value:"other",label:"その他"}],register:f("category"),error:y.category?.message}),(0,r.jsx)(u,{label:"説明（オプション）",placeholder:"写真の説明を入力",register:f("description")}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)(l.A,{variant:"secondary",onClick:k,children:"キャンセル"}),(0,r.jsx)(l.A,{variant:"primary",onClick:v(e=>{s(e),k()}),disabled:!n,children:"アップロード"})]})]})})};var v=s(96067);class y{get headers(){let e={Accept:"application/json"};return this.authToken&&(e.Authorization=`Bearer ${this.authToken}`),e}setAuthToken(e){this.authToken=e}clearAuthToken(){this.authToken=null}async handleResponse(e){if(!e.ok){if(401===e.status)throw Error("認証が必要です。ログインしてください。");throw Error((await e.json().catch(()=>({}))).detail||`API Error: ${e.status}`)}return e.json()}async getPhotos(e=1,t=20){try{let s=await fetch(`${this.baseURL}/gallery/admin?page=${e}&limit=${t}`,{method:"GET",headers:this.headers});return await this.handleResponse(s)}catch(e){throw console.error("Failed to fetch photos:",e),e}}async deletePhoto(e){try{let t=await fetch(`${this.baseURL}/gallery/admin/${e}`,{method:"DELETE",headers:this.headers});if(!t.ok)throw Error(`Failed to delete photo: ${t.status}`)}catch(e){throw console.error("Failed to delete photo:",e),e}}constructor(){this.baseURL=v.p,this.authToken=null,this.createPhoto=async e=>{try{let t=new FormData;t.append("title",e.title),t.append("description",e.description||""),t.append("file_type","image"),t.append("file",e.file);let s={...this.headers};delete s["Content-Type"];let r=await fetch(`${this.baseURL}/gallery/admin`,{method:"POST",headers:s,body:t});return await this.handleResponse(r)}catch(e){throw console.error("Failed to create photo:",e),e}}}}let j=new y,w={default:()=>["gallery"],list:e=>[...w.default(),"list",e],detail:e=>[...w.default(),"detail",e]};var N=s(8693),k=s(65406),P=s(33465),A=s(35536),E=s(31212),C=class extends A.Q{#e;#t=void 0;#s;#r;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,E.f8)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,E.EN)(t.mutationKey)!==(0,E.EN)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#i(),this.#a()}mutate(e,t){return this.#r=t,this.#s?.removeObserver(this),this.#s=this.#e.getMutationCache().build(this.#e,this.options),this.#s.addObserver(this),this.#s.execute(e)}#i(){let e=this.#s?.state??(0,k.$)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#a(e){P.jG.batch(()=>{if(this.#r&&this.hasListeners()){let t=this.#t.variables,s=this.#t.context;e?.type==="success"?(this.#r.onSuccess?.(e.data,t,s),this.#r.onSettled?.(e.data,null,t,s)):e?.type==="error"&&(this.#r.onError?.(e.error,t,s),this.#r.onSettled?.(void 0,e.error,t,s))}this.listeners.forEach(e=>{e(this.#t)})})}};function O(e,t){let s=(0,N.jE)(t),[r]=i.useState(()=>new C(s,e));i.useEffect(()=>{r.setOptions(e)},[r,e]);let a=i.useSyncExternalStore(i.useCallback(e=>r.subscribe(P.jG.batchCalls(e)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),n=i.useCallback((e,t)=>{r.mutate(e,t).catch(E.lQ)},[r]);if(a.error&&(0,E.GU)(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:n,mutateAsync:a.mutate}}var R=s(93853);let M=()=>{let e=(0,N.jE)();return O({mutationFn:j.createPhoto,onSuccess:()=>{e.invalidateQueries({queryKey:w.default()}),R.oR.success("写真をアップロードしました")},onError:e=>{R.oR.error(e.message||"アップロードに失敗しました")}})},S=()=>{let e=(0,N.jE)();return O({mutationFn:j.deletePhoto,onSuccess:()=>{e.invalidateQueries({queryKey:w.default()}),R.oR.success("写真を削除しました")},onError:e=>{R.oR.error(e.message||"削除に失敗しました")}})},z={getPhotos:(e=1,t=20)=>({queryKey:w.list({page:e,limit:t}),queryFn:()=>j.getPhotos(e,t)})};var _=s(5957);let F=({selectedCategory:e,onCategoryChange:t})=>(0,r.jsxs)("select",{value:e,onChange:e=>t(e.target.value),className:"rounded-lg border border-gray-300 px-2 lg:px-3 w-30 lg:w-50 py-3",children:[(0,r.jsx)("option",{value:"all",children:"すべてのカテゴリー"}),(0,r.jsx)("option",{value:"work",children:"仕事"}),(0,r.jsx)("option",{value:"travel",children:"旅行"}),(0,r.jsx)("option",{value:"event",children:"イベント"}),(0,r.jsx)("option",{value:"other",children:"その他"})]}),q=()=>{let[e,t]=(0,i.useState)("all"),[s,c]=(0,i.useState)(!1),[d,u]=(0,i.useState)(!1),[h,p]=(0,i.useState)(1),m=M(),x=S(),{data:b,isLoading:g,error:v,refetch:y}=(0,a.I)({...z.getPhotos(h,20),enabled:d,retry:(e,t)=>!t.message.includes("認証が必要です")&&e<3});(0,i.useEffect)(()=>{let e=localStorage.getItem("accessToken");e&&(j.setAuthToken(e),u(!0))},[]);let w=async e=>{try{await m.mutateAsync({title:e.title,description:e.description||"",file:e.file}),c(!1)}catch(e){console.error("Upload failed:",e)}},N=async e=>{if(confirm("この写真を削除してもよろしいですか？"))try{await x.mutateAsync(e)}catch(e){console.error("Delete failed:",e)}},k=b?.results||[],P=m.isPending;return(0,r.jsxs)("div",{className:"flex min-h-screen lg:p-4 bg-white ",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(_.A,{items:[{label:"写真アルバム",href:"/admin/photo-albums"}],homeHref:"/admin"})}),(0,r.jsx)("header",{className:"border-b border-gray-200 bg-white px-6 py-4",children:(0,r.jsx)("h1",{className:"text-2xl font-medium text-gray-800",children:"アリバイ写真アルバム管理"})}),(0,r.jsxs)("main",{className:"lg:p-6 p-3",children:[(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsx)(F,{selectedCategory:e,onCategoryChange:t}),(0,r.jsx)(l.A,{variant:"primary",leftIcon:(0,r.jsx)(n.A,{className:"h-4 w-4"}),onClick:()=>{c(!0)},disabled:P,children:P?"アップロード中...":"新規写真をアップロード"})]}),v&&(0,r.jsxs)("div",{className:"mb-4 rounded-lg bg-red-50 p-3 text-sm text-red-500 flex items-center justify-between",children:[(0,r.jsx)("span",{children:v.message}),(0,r.jsx)(l.A,{variant:"secondary",onClick:()=>{y()},children:"再試行"})]}),g?(0,r.jsx)("div",{className:"flex justify-center py-12",children:(0,r.jsx)("div",{className:"text-gray-600",children:"読み込み中..."})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5",children:[k.map(e=>(0,r.jsx)(o,{photo:{id:e.uid,url:e.file,title:e.title,created_at:e.created_at||new Date().toISOString()},onDelete:()=>N(e.uid)},e.uid)),0===k.length&&(0,r.jsx)("div",{className:"col-span-full py-12 text-center text-gray-500",children:"写真が見つかりません"})]}),b&&(b.next||b.previous)&&(0,r.jsxs)("div",{className:"mt-6 flex justify-center space-x-2",children:[(0,r.jsx)(l.A,{variant:"secondary",disabled:!b.previous||g,onClick:()=>p(h-1),children:"前のページ"}),(0,r.jsxs)("span",{className:"flex items-center px-4 py-2 text-sm text-gray-600",children:["ページ ",h]}),(0,r.jsx)(l.A,{variant:"secondary",disabled:!b.next||g,onClick:()=>p(h+1),children:"次のページ"})]})]})]})]}),(0,r.jsx)(f,{isOpen:s,onClose:()=>{c(!1)},onSubmit:w,selectedCategory:e})]})}},42412:(e,t,s)=>{Promise.resolve().then(s.bind(s,20463))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79551:e=>{"use strict";e.exports=require("url")},85852:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c});var r=s(65239),i=s(48088),a=s(88170),n=s.n(a),o=s(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c={children:["",{children:["(admin)",{children:["admin",{children:["(routes)",{children:["photo-albums",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,20463)),"/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/(admin)/admin/(routes)/photo-albums/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,88346)),"/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/(admin)/admin/layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,92194)),"/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/(admin)/admin/loading.tsx"]}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,35286)),"/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,67393)),"/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["/home/roushan-sheik/Projects/Office /project-xyz/live-repo/Alibi-FE/src/app/(admin)/admin/(routes)/photo-albums/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/(admin)/admin/(routes)/photo-albums/page",pathname:"/admin/photo-albums",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},96067:(e,t,s)=>{"use strict";s.d(t,{p:()=>r});let r="https://api-dev.examplesite.jp"}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4447,6099,1658,3153,5814,880,3853,7605,2212,1423,7376],()=>s(85852));module.exports=r})();